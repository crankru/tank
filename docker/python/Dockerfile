FROM python:3.8.8-buster

ENV DOCKER=1 PYTHONUNBUFFERED=1 DEBIAN_FRONTEND=noninteractive 

RUN apt-get update && apt-get install -y i2c-tools build-essential cmake \
    && pip install pip-tools
ADD requirements.txt /requirements.txt
RUN pip install -r /requirements.txt

RUN apt-get install -y sudo

# build userland
RUN cd /tmp && git clone https://github.com/raspberrypi/userland.git \
    && cd userland/ && ./buildme \
    && ln -s /tmp/userland/build/bin/vcgencmd /usr/bin/vcgencmd
    # cp libbcm_host.so /opt/vc/lib/

RUN echo '/opt/vc/lib' > /etc/ld.so.conf.d/vc.conf ; ldconfig
    # && env-update \
    # && ldconfig

# && echo -e '# /etc/env.d/00vcgencmd\n# Do not edit this file\n\nPATH="/opt/vc/bin:/opt/vc/sbin"\nROOTPATH="/opt/vc/bin:/opt/vc/sbin"\nLDPATH="/opt/vc/lib"' > /etc/env.d/00vcgencmd \

WORKDIR /code