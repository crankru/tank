FROM python:3.8.8-buster

ENV DOCKER=1 PYTHONUNBUFFERED=1 DEBIAN_FRONTEND=noninteractive 

RUN apt-get update && pip install pip-tools
ADD requirements.txt /requirements.txt
RUN pip install -r /requirements.txt

RUN apt-get install -y build-essential cmake \
    && cd /tmp && git clone https://github.com/raspberrypi/userland.git \
    && cd userland/ && ./buildme

RUN ln -s /tmp/userland/build/bin/vcgencmd /usr/bin/vcgencmd
# root # echo '/opt/vc/lib' > /etc/ld.so.conf.d/vc.conf ; ldconfig
# root # echo -e '# /etc/env.d/00vcgencmd\n# Do not edit this file\n\nPATH="/opt/vc/bin:/opt/vc/sbin"\nROOTPATH="/opt/vc/bin:/opt/vc/sbin"\nLDPATH="/opt/vc/lib"' > /etc/env.d/00vcgencmd
# root # env-update
# root # ldconfig

WORKDIR /code